files:

  "/opt/elasticbeanstalk/hooks/appdeploy/post/01run_migrations.sh":
    mode: "000755"
    owner: root
    group: users
    content: |
      #!/usr/bin/env bash

      . /opt/elasticbeanstalk/env.vars

      # codebuild packages flattens symlinks, knex command won't fail anymore
      # ln -nfs $EB_APP_DEPLOY_DIR/node_modules/knex/bin/cli.js $EB_APP_DEPLOY_DIR/node_modules/.bin/knex

      cd $EB_APP_DEPLOY_DIR

      npm run migrate
